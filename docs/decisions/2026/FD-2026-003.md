_**[APPROVED DRAFT]**_

# FD-2026-003: Sync-On-Reconnect Is Mandatory

**Status:** Ratified
**Ratified:** 2026-02-02
**Replaces:** None

---

## 1. Mandate

This Founder Decision (FD) mandates that all client applications within the WebWaka Agentic Software Factory must implement an automatic, robust, and transparent synchronization mechanism that activates upon network reconnection. This ensures that offline-generated data is promptly and reliably synced with the server, maintaining data consistency across the ecosystem.

## 2. Specification

### 2.1. Reconnection Detection

A reliable two-factor mechanism must be used to detect a stable network reconnection.

*   **Mechanism:** A combination of a network status change event (provided by the host operating system or browser) and a successful API heartbeat to a designated health-check endpoint.
*   **Definition of “Reconnected”:** A connection is considered stable and “reconnected” only after maintaining connectivity for a continuous period of **≥5 seconds**.

### 2.2. Sync Initiation

The synchronization process must be automatic and non-intrusive to the user experience.

*   **Automation:** The sync process must initiate automatically without requiring any user action.
*   **Stabilization Delay:** A **5-second stabilization delay** must be observed after a stable reconnection is detected before initiating the sync process.
*   **User Notification:** The user must be clearly notified when the synchronization process begins and when it completes (successfully or with errors).

### 2.3. Conflict Resolution

A consistent and predictable conflict resolution strategy is required to handle data conflicts that may arise during synchronization.

*   **Detection:** Conflicts will be detected using a combination of a **version vector** and the `last_modified` timestamp of the entity.
*   **Default Strategy:** The default conflict resolution strategy is **server-wins**. The server’s version of the data will always take precedence in the event of a conflict.
*   **Conflict Auditing:** All conflicts must be surfaced to the user with a clear audit log detailing the nature of the conflict and the resolution applied.

### 2.4. Retry Logic

A resilient retry mechanism with exponential backoff is required for handling transient network failures during the sync process.

| Parameter           | Value                               | Notes                                                                 |
| :------------------ | :---------------------------------- | :-------------------------------------------------------------------- |
| **Max Retries**     | 10 per transaction                  | The maximum number of retry attempts for a single transaction.        |
| **Backoff Strategy**| Exponential (base 2, max 5 minutes) | The delay between retries will double with each attempt, up to a maximum of 5 minutes. |
| **Max Retry Window**| 24 hours                            | The maximum duration during which retries will be attempted.          |
| **Failure Action**  | Move to `DEAD_LETTER`               | After all retry attempts are exhausted, the transaction is moved to the `DEAD_LETTER` queue. |

### 2.5. Sync Progress & Visibility

The user must be kept informed of the synchronization progress at all times.

*   **Mandatory UI:** A progress indicator user interface (UI) is mandatory during the sync process.
*   **Display Format:** The UI must display, at a minimum, the number of transactions being synced (e.g., “Syncing X of Y”).
*   **Error Handling:** Any errors that occur during the sync process must be surfaced to the user immediately.

### 2.6. Partial Sync Handling

The synchronization process must be resilient to partial failures.

*   **Continue on Failure:** The sync process must continue even if individual transactions fail to sync.
*   **Per-Transaction Tracking:** The outcome of each transaction (success or failure) must be tracked individually.
*   **Partial Success:** Partial success is allowed and must be recorded. A sync process is considered partially successful if at least one transaction is successfully synced.

## 3. Enforcement

Compliance with this specification will be enforced through automated CI checks and mandatory peer reviews for all related code changes. Any deviation requires a formal exception request to be approved by the Founder.
